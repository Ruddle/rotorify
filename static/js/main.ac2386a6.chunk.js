(this.webpackJsonprotorify=this.webpackJsonprotorify||[]).push([[0],{18:function(e,t,n){},19:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),i=n(13),o=n.n(i),s=(n(18),n.p,n(19),n(1)),c=n(5),u=n.n(c),l=n(6),d=n(2),b=n(4),f=function(e){var t=a.a.useRef(),n=a.a.useRef(),r=function r(a){if(void 0!=n.current){var i=a-n.current;e(i)}n.current=a,t.current=requestAnimationFrame(r)};a.a.useEffect((function(){return t.current=requestAnimationFrame(r),function(){return cancelAnimationFrame(t.current)}}),[])};var m=n(0),h=window.Ammo,v=n(38),j=(n(22),n(36)),y=(n(37),null);function p(e){var t,n,r;n=new v.Scene,(r=new v.WebGLRenderer({canvas:e,antialias:!0})).setSize(window.innerWidth-300,window.innerHeight),(n=new v.Scene).background=new v.Color(12571109),(t=new v.PerspectiveCamera(70,(window.innerWidth-300)/window.innerHeight,.2,5e3)).position.set(0,1.7,4),t.lookAt(new v.Vector3(0,1.7,0));var a=new v.HemisphereLight(16777215,16777215,.1);a.color.setHSL(.6,.6,.6),a.groundColor.setHSL(.1,1,.4),a.position.set(0,50,0),n.add(a);var i=new v.DirectionalLight(16777215,1);i.color.setHSL(.1,1,.95),i.position.set(-1,1.75,1),i.position.multiplyScalar(100),n.add(i),i.castShadow=!0,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048;return i.shadow.camera.left=-50,i.shadow.camera.right=50,i.shadow.camera.top=50,i.shadow.camera.bottom=-50,i.shadow.camera.far=13500,r.setClearColor(12571109),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth-300,window.innerHeight),r.gammaInput=!0,r.gammaOutput=!0,r.shadowMap.enabled=!0,{camera:t,scene:n,renderer:r}}function w(e){var t=e.physicsWorld,n=e.scene,r=0,a=-1,i=0,o=20,s=2,c=20,u=0,l=0,d=0,b=1,f=new v.Mesh(new v.BoxBufferGeometry,new v.MeshPhongMaterial({color:10530724}));f.position.set(r,a,i),f.scale.set(o,s,c),f.castShadow=!0,f.receiveShadow=!0,n.add(f);var m=new h.btTransform;m.setIdentity(),m.setOrigin(new h.btVector3(r,a,i)),m.setRotation(new h.btQuaternion(u,l,d,b));var j=new h.btDefaultMotionState(m),y=new h.btBoxShape(new h.btVector3(.5*o,.5*s,.5*c));y.setMargin(.05);var p=new h.btVector3(0,0,0);y.calculateLocalInertia(0,p);var w=new h.btRigidBodyConstructionInfo(0,j,y,p),x=new h.btRigidBody(w);t.addRigidBody(x)}function x(e){!function(e){for(var t=e.physicsWorld,n=e.scene,r=e.rigidBodies,a=0;a<r.length;a++){var i=r[a],o=i.userData.physicsBody;t.removeRigidBody(o);try{h.destroy(o.getCollisionShape()),h.destroy(o.getMotionState()),h.destroy(o)}catch(s){console.error(s)}n.remove(i)}r.length=0}(e),function(e){var t=e.physicsWorld,n=e.scene,r=e.rigidBodies,a=e.droneData,i=0,o=5,s=0,c=0,u=0,l=0,d=1,b=a.totalMass/1e3,f=new v.Group;if("quadrotor +"===a.type){var m=.02,j=a.motorCenterDistance/1e3,y=new v.Mesh(new v.SphereBufferGeometry(m),new v.MeshPhongMaterial({color:16712965}));y.position.set(j,0,0);var p=new v.Mesh(new v.SphereBufferGeometry(m),new v.MeshPhongMaterial({color:16712965}));p.position.set(-j,0,0);var w=new v.Mesh(new v.SphereBufferGeometry(m),new v.MeshPhongMaterial({color:16712965}));w.position.set(0,0,-j);var x=new v.Mesh(new v.SphereBufferGeometry(m),new v.MeshPhongMaterial({color:16712965}));x.position.set(0,0,j),f.add(y),f.add(p),f.add(w),f.add(x)}f.position.set(i,o,s),f.castShadow=!0,f.receiveShadow=!0,n.add(f);var g=new h.btTransform;g.setIdentity(),g.setOrigin(new h.btVector3(i,o,s)),g.setRotation(new h.btQuaternion(c,u,l,d));var O=new h.btDefaultMotionState(g),C=new h.btSphereShape(a.motorCenterDistance/1e3);C.setMargin(.05);var M=new h.btVector3(0,0,0);C.calculateLocalInertia(b,M);var S=new h.btRigidBodyConstructionInfo(b,O,C,M),D=new h.btRigidBody(S);D.setActivationState(4),f.userData.physicsBody=D,t.addRigidBody(D),r.push(f)}(e),e.sim=O()}function g(){var e=new h.btDefaultCollisionConfiguration,t=new h.btCollisionDispatcher(e),n=new h.btDbvtBroadphase,r=new h.btSequentialImpulseConstraintSolver,a=new h.btDiscreteDynamicsWorld(t,n,r,e);return a.setGravity(new h.btVector3(0,-9.8,0)),y=new h.btTransform,a}var O=function(){return{battery:100,batteryChart:[],yChart:[],vyChart:[],throttle:0,ms:0}};function C(){var e,t=Object(r.useRef)(null),n=Object(r.useRef)(),a=Object(r.useState)({type:"quadrotor +",motorCenterDistance:100,motorKV:1e4,motorMass:20,motorLiftPerWatt:.05,escMass:20,batteryMass:100,batteryS:2,batteryP:1,batteryC:45,batteryCapacity:850,frameMass:100,totalMass:0,v:0,mA:0,w:0,j:0}),i=Object(b.a)(a,2),o=i[0],c=i[1],v=Object(r.useState)(O()),C=Object(b.a)(v,2),V=C[0],B=C[1],R=Object(r.useState)(!1),P=Object(b.a)(R,2),W=P[0],I=P[1];function L(e){c(e),I(!1)}return Object(r.useEffect)((function(){if(W){var e;(null===(e=t.current)||void 0===e?void 0:e.alive)&&(t.current.droneData=o,x(t.current))}else{var n,r=Object(d.a)(Object(d.a)(Object(d.a)({},j(o)),function(e){var t=3.7*e.batteryS,n=e.batteryC*e.batteryCapacity;return{v:t,mA:n,w:t*n/1e3,j:3600*e.batteryCapacity/1e3*t}}(o)),{totalMass:4*(a=o).escMass+4*a.motorMass+a.batteryMass+a.frameMass});(null===(n=t.current)||void 0===n?void 0:n.alive)&&(t.current.droneData=r),c(r),I(!0)}var a}),[o,W]),Object(r.useEffect)((function(){var e;function r(){return a.apply(this,arguments)}function a(){return(a=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Trying to load Ammo.js"),e.prev=1,e.next=4,h();case 4:h=e.sent,t.current=p(n.current),t.current.physicsWorld=g(),t.current.rigidBodies=[],w(t.current),t.current.alive=!0,I(!1),t.current.sim=O(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("ammo: ",e.t0),setTimeout((function(){return r()}),500);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}void 0==(null===(e=h)||void 0===e?void 0:e.btDefaultCollisionConfiguration)&&r()}),[]),f((function(e){if(null!=t.current){var n=t.current,r=n.camera,a=n.scene,i=n.renderer,o=n.sim,s=n.droneData,c=n.rigidBodies;!function(e,t){var n=e.physicsWorld,r=e.rigidBodies,a=e.sim,i=e.droneData;if(i)for(var o=0;o<t;o++){n.stepSimulation(.001,0);var s=a.throttle*(.001*i.batteryC*100)/3600;a.battery=Math.max(0,a.battery-s);var c=s/100*i.j/.001,u=i.motorLiftPerWatt*c,l=r[0].userData.physicsBody,d=new h.btVector3(0,u/1e3,0);if(l.applyImpulse(d,new h.btVector3(0,0,0)),a.ms+=1,a.ms%30===0){a.batteryChart.push(a.battery),l.getMotionState().getWorldTransform(y);var b=y.getOrigin().y();a.yChart.push(b);var f=l.getLinearVelocity().y();a.vyChart.push(f)}}for(var m=0;m<r.length;m++){var v=r[m],j=v.userData.physicsBody.getMotionState();if(j){j.getWorldTransform(y);var p=y.getOrigin(),w=y.getRotation();v.position.set(p.x(),p.y(),p.z()),v.quaternion.set(w.x(),w.y(),w.z(),w.w())}}}({physicsWorld:n.physicsWorld,rigidBodies:c,sim:o,droneData:s},e),B(j(o)),i.render(a,r)}})),Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"row",background:"rgb(62, 62, 62)",overflow:"hidden"},children:[Object(m.jsxs)("div",{style:{position:"relative",overflow:"hidden"},children:[Object(m.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",display:"flex",flexDirection:"column"},children:[Object(m.jsxs)("div",{children:[" ",V.ms+"ms"]}),Object(m.jsxs)("div",{children:[" ",V.battery.toFixed(2)+"%"]}),Object(m.jsx)(D,{name:"battery",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.batteryChart}}),Object(m.jsx)(D,{name:"y",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.yChart}}),Object(m.jsx)(D,{name:"vy",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.vyChart}})]}),Object(m.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translate(-50%,0%)"},children:Object(m.jsx)("input",(e={type:"range",min:"0",max:"1",value:"0",step:"0.01"},Object(s.a)(e,"value",V.throttle),Object(s.a)(e,"onChange",(function(e){return t.current.sim.throttle=parseFloat(e.target.value)})),e))}),Object(m.jsx)("canvas",{ref:n,style:{flex:"1 1 auto"}})]}),Object(m.jsxs)("div",{style:{width:"300px",overflowY:"auto",height:"100%"},children:[Object(m.jsx)(M,{name:"motor center distance",unit:"mm",value:o.motorCenterDistance,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorCenterDistance:e})}))}}),Object(m.jsx)(M,{name:"motor kv",unit:"RPM/V",value:o.motorKV,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorKV:e})}))}}),Object(m.jsx)(M,{name:"single motor mass",unit:"g",value:o.motorMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorMass:e})}))}}),Object(m.jsx)(M,{name:"motor lift",unit:"N/W",value:o.motorLiftPerWatt,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorLiftPerWatt:e})}))}}),Object(m.jsx)(M,{name:"single esc mass",unit:"g",value:o.escMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{escMass:e})}))}}),Object(m.jsx)(M,{name:"battery mass",unit:"g",value:o.batteryMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryMass:e})}))}}),Object(m.jsx)(M,{name:"battery capacity",unit:"mAh",value:o.batteryCapacity,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryCapacity:e})}))}}),Object(m.jsx)(M,{name:"battery S",unit:"",value:o.batteryS,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryS:e})}))}}),Object(m.jsx)(M,{name:"battery P",unit:"",value:o.batteryP,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryP:e})}))}}),Object(m.jsx)(M,{name:"battery C",unit:"h-1",value:o.batteryC,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryC:e})}))}}),Object(m.jsx)(M,{name:"frame mass",unit:"g",value:o.frameMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{frameMass:e})}))}}),Object(m.jsx)(S,{name:"total mass",unit:"g",value:o.totalMass}),Object(m.jsx)(S,{name:"total V",unit:"V",value:o.v}),Object(m.jsx)(S,{name:"max current",unit:"mA",value:o.mA}),Object(m.jsx)(S,{name:"max power",unit:"W",value:o.w})]})]})}function M(e){var t=e.name,n=e.unit,r=e.value,a=e.setValue;return Object(m.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"10px"},children:[Object(m.jsx)("div",{style:{textAlign:"left"},children:t}),Object(m.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"120px",flex:"none"},children:[Object(m.jsx)("input",{style:{width:"60px"},value:r,type:"number",onChange:function(e){var t=parseFloat(e.target.value);a(t)}})," ",Object(m.jsx)("span",{style:{marginLeft:"5px"},children:n})]})]})}function S(e){var t=e.name,n=e.unit,r=e.value;return Object(m.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"10px"},children:[Object(m.jsx)("div",{style:{textAlign:"left"},children:t}),Object(m.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"120px",flex:"none"},children:[Object(m.jsx)("input",{disabled:!0,style:{width:"60px"},value:r})," ",Object(m.jsx)("span",{style:{marginLeft:"5px"},children:n})]})]})}function D(e){var t=e.arrf,n=e.name,a=Object(r.useRef)(),i=Object(r.useRef)({min:9999,max:-9999,lastComputeIndex:-1}),o=200,s=200;return f((function(e){var n=t();if(a.current&&n&&i.current){i.current.lastComputeIndex>n.length-1&&(i.current={min:9999,max:-9999,lastComputeIndex:-1});var r=i.current;a.current.width=o,a.current.height=s;var c=a.current.getContext("2d");c.width=o,c.height=s,c.fillStyle="rgba(0,0,0,0.6)",c.fillRect(0,0,o,s);for(var u=r.lastComputeIndex+1;u<n.length;u++)r.min=Math.min(r.min,n[u]),r.max=Math.max(r.max,n[u]);r.lastComputeIndex=n.length-1;var l=r.max-r.min,d=r.max+l/10,b=r.min-l/10,f=function(e){return s-s*(e-b)/(d-b)},m=function(e){return e*o/(n.length-1)};c.beginPath(),c.moveTo(m(0),f(n[0]||0)),n.forEach((function(e,t){c.lineTo(m(t),f(e))})),c.strokeStyle="#fff",c.stroke()}})),Object(m.jsxs)("div",{style:{border:"1px solid black",background:"rgba(0,0,0,0.8)",color:"white"},children:[Object(m.jsx)("div",{children:n}),Object(m.jsx)("canvas",{ref:a,style:{width:o+"px",height:s+"px"}})]})}var V=function(){return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(C,{})})},B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};o.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(V,{})}),document.getElementById("root")),B()}},[[39,1,2]]]);
//# sourceMappingURL=main.ac2386a6.chunk.js.map