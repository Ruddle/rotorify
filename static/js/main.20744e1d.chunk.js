(this.webpackJsonprotorify=this.webpackJsonprotorify||[]).push([[0],{18:function(e,t,n){},19:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),i=n(13),o=n.n(i),s=(n(18),n.p,n(19),n(1)),c=n(5),u=n.n(c),l=n(6),d=n(2),m=n(4),f=function(e,t,n){return Math.max(t,Math.min(n,e))},b=function(e){var t=a.a.useRef(),n=a.a.useRef(),r=function r(a){if(void 0!=n.current){var i=a-n.current;e(i)}n.current=a,t.current=requestAnimationFrame(r)};a.a.useEffect((function(){return t.current=requestAnimationFrame(r),function(){return cancelAnimationFrame(t.current)}}),[])};var h=n(0),v=window.Ammo,y=n(38),j=(n(22),n(36)),p=(n(37),null);function w(e){var t,n,r;n=new y.Scene,(r=new y.WebGLRenderer({canvas:e,antialias:!0})).setSize(window.innerWidth-300,window.innerHeight),(n=new y.Scene).background=new y.Color(12571109),(t=new y.PerspectiveCamera(70,(window.innerWidth-300)/window.innerHeight,.2,5e3)).position.set(0,1.7,4),t.lookAt(new y.Vector3(0,1.7,0));var a=new y.HemisphereLight(16777215,16777215,.1);a.color.setHSL(.6,.6,.6),a.groundColor.setHSL(.1,1,.4),a.position.set(0,50,0),n.add(a);var i=new y.DirectionalLight(16777215,1);i.color.setHSL(.1,1,.95),i.position.set(-1,1.75,1),i.position.multiplyScalar(100),n.add(i),i.castShadow=!0,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048;return i.shadow.camera.left=-10,i.shadow.camera.right=10,i.shadow.camera.top=10,i.shadow.camera.bottom=-10,i.shadow.camera.far=13500,r.setClearColor(12571109),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth-300,window.innerHeight),r.gammaInput=!0,r.gammaOutput=!0,r.shadowMap.enabled=!0,{camera:t,scene:n,renderer:r}}function x(e){var t=e.physicsWorld,n=e.scene,r=0,a=-1,i=0,o=20,s=2,c=20,u=0,l=0,d=0,m=1,f=new y.Mesh(new y.BoxBufferGeometry,new y.MeshPhongMaterial({color:10530724}));f.position.set(r,a,i),f.scale.set(o,s,c),f.castShadow=!0,f.receiveShadow=!0,n.add(f);var b=new v.btTransform;b.setIdentity(),b.setOrigin(new v.btVector3(r,a,i)),b.setRotation(new v.btQuaternion(u,l,d,m));var h=new v.btDefaultMotionState(b),j=new v.btBoxShape(new v.btVector3(.5*o,.5*s,.5*c));j.setMargin(.05);var p=new v.btVector3(0,0,0);j.calculateLocalInertia(0,p);var w=new v.btRigidBodyConstructionInfo(0,h,j,p),x=new v.btRigidBody(w);t.addRigidBody(x)}function g(e){!function(e){for(var t=e.physicsWorld,n=e.scene,r=e.rigidBodies,a=0;a<r.length;a++){var i=r[a],o=i.userData.physicsBody;t.removeRigidBody(o);try{v.destroy(o.getCollisionShape()),v.destroy(o.getMotionState()),v.destroy(o)}catch(s){console.error(s)}n.remove(i)}r.length=0}(e),function(e){var t=e.physicsWorld,n=e.scene,r=e.rigidBodies,a=e.droneData,i=0,o=5,s=0,c=0,u=0,l=0,d=1,m=a.totalMass/1e3,f=new y.Group;if("quadrotor +"===a.type){var b=.02,h=a.motorCenterDistance/1e3,j=new y.Mesh(new y.SphereBufferGeometry(b),new y.MeshPhongMaterial({color:16712965}));j.position.set(h,0,0),j.castShadow=!0,f.add(j);var p=new y.Mesh(new y.SphereBufferGeometry(b),new y.MeshPhongMaterial({color:16712965}));p.position.set(-h,0,0),p.castShadow=!0,f.add(p);var w=new y.Mesh(new y.SphereBufferGeometry(b),new y.MeshPhongMaterial({color:16712965}));w.position.set(0,0,-h),w.castShadow=!0,f.add(w);var x=new y.Mesh(new y.SphereBufferGeometry(b),new y.MeshPhongMaterial({color:16712965}));x.position.set(0,0,h),x.castShadow=!0,f.add(x);var g=new y.Mesh(new y.BoxBufferGeometry(.01,.01,2*h),new y.MeshPhongMaterial({color:0}));g.position.set(0,0,0),g.castShadow=!0,f.add(g);var O=new y.Mesh(new y.BoxBufferGeometry(2*h,.01,.01),new y.MeshPhongMaterial({color:0}));O.position.set(0,0,0),O.castShadow=!0,f.add(O)}f.position.set(i,o,s),f.castShadow=!0,f.receiveShadow=!0,n.add(f);var M=new v.btTransform;M.setIdentity(),M.setOrigin(new v.btVector3(i,o,s)),M.setRotation(new v.btQuaternion(c,u,l,d));var S=new v.btDefaultMotionState(M),C=new v.btBoxShape(new v.btVector3(a.motorCenterDistance/1e3,.02,a.motorCenterDistance/1e3));C.setMargin(.05);var B=new v.btVector3(0,0,0);C.calculateLocalInertia(m,B);var D=new v.btRigidBodyConstructionInfo(m,S,C,B),V=new v.btRigidBody(D);V.setActivationState(4),f.userData.physicsBody=V,t.addRigidBody(V),r.push(f)}(e),e.sim=M()}function O(){var e=new v.btDefaultCollisionConfiguration,t=new v.btCollisionDispatcher(e),n=new v.btDbvtBroadphase,r=new v.btSequentialImpulseConstraintSolver,a=new v.btDiscreteDynamicsWorld(t,n,r,e);return a.setGravity(new v.btVector3(0,-9.8,0)),p=new v.btTransform,a}var M=function(){return{battery:100,batteryChart:[],yChart:[],vyChart:[],throttle:0,ms:0,stage:"free",pids:{alt:{p:1,i:20,d:1.9,accI:[]}},simTime:0,deltaToSim:0}};function S(){var e,t=Object(r.useRef)(null),n=Object(r.useRef)(),a=Object(r.useState)({type:"quadrotor +",motorCenterDistance:100,motorKV:1e4,motorMass:20,motorLiftPerWatt:.05,escMass:20,batteryMass:100,batteryS:2,batteryP:1,batteryC:45,batteryCapacity:850,frameMass:100,totalMass:0,v:0,mA:0,w:0,j:0}),i=Object(m.a)(a,2),o=i[0],c=i[1],y=Object(r.useState)(M()),S=Object(m.a)(y,2),V=S[0],T=S[1],I=Object(r.useState)(!1),P=Object(m.a)(I,2),R=P[0],W=P[1];function L(e){c(e),W(!1)}return Object(r.useEffect)((function(){if(R){var e;(null===(e=t.current)||void 0===e?void 0:e.alive)&&(t.current.droneData=o,g(t.current))}else{var n,r=Object(d.a)(Object(d.a)(Object(d.a)({},j(o)),function(e){var t=3.7*e.batteryS,n=e.batteryC*e.batteryCapacity;return{v:t,mA:n,w:t*n/1e3,j:3600*e.batteryCapacity/1e3*t}}(o)),{totalMass:4*(a=o).escMass+4*a.motorMass+a.batteryMass+a.frameMass});(null===(n=t.current)||void 0===n?void 0:n.alive)&&(t.current.droneData=r),c(r),W(!0)}var a}),[o,R]),Object(r.useEffect)((function(){var e;function r(){return a.apply(this,arguments)}function a(){return(a=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Trying to load Ammo.js"),e.prev=1,e.next=4,v();case 4:v=e.sent,t.current=w(n.current),t.current.physicsWorld=O(),t.current.rigidBodies=[],x(t.current),t.current.alive=!0,W(!1),t.current.sim=M(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("ammo: ",e.t0),setTimeout((function(){return r()}),500);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}void 0==(null===(e=v)||void 0===e?void 0:e.btDefaultCollisionConfiguration)&&r()}),[]),b((function(e){if(null!=t.current){var n=t.current,r=n.camera,a=n.scene,i=n.renderer,o=n.sim,s=n.droneData,c=n.rigidBodies;!function(e,t){var n=e.physicsWorld,r=e.rigidBodies,a=e.sim,i=e.droneData,o=performance.now();if(a.deltaToSim=t,a.simTime=0,i){var s=function(){n.stepSimulation(.001,0);var e=r[0].userData.physicsBody;e.getMotionState().getWorldTransform(p);var t=[p.getOrigin().x(),p.getOrigin().y(),p.getOrigin().z()][1],o=[e.getLinearVelocity().x(),e.getLinearVelocity().y(),e.getLinearVelocity().z()][1];if("training.pid.alt"===a.stage){e.getMotionState().getWorldTransform(p);var s={x:0,y:0,z:0,w:1},c=new v.btQuaternion(s.x,s.y,s.z,s.w);p.setRotation(c),v.destroy(c),e.getMotionState().setWorldTransform(p);var u=3-t;a.pids.alt.accI=.9*a.pids.alt.accI+.1*u,a.throttle=f(a.pids.alt.p*u-a.pids.alt.d*o+a.pids.alt.i*a.pids.alt.accI,0,1)}var l=a.throttle*(.001*i.batteryC*100)/3600,d=a.battery;a.battery=Math.max(0,a.battery-l);var m=(l=d-a.battery)/100*i.j/.001,b=i.motorLiftPerWatt*m,h=new v.btVector3(0,b/1e3,0),y=new v.btVector3(0,0,0);e.applyImpulse(h,y),v.destroy(h),v.destroy(y),a.ms%30===0&&(a.batteryChart.push(a.battery),a.yChart.push(t),a.vyChart.push(o)),a.ms+=1};if("free"===a.stage)for(var c=0;c<t;c++)s();else for(;a.simTime+1<a.deltaToSim&&a.simTime+1<33;)s(),a.simTime=performance.now()-o}a.simTime=performance.now()-o;for(var u=0;u<r.length;u++){var l=r[u],d=l.userData.physicsBody.getMotionState();if(d){d.getWorldTransform(p);var m=p.getOrigin(),b=p.getRotation();l.position.set(m.x(),m.y(),m.z()),l.quaternion.set(b.x(),b.y(),b.z(),b.w())}}}({physicsWorld:n.physicsWorld,rigidBodies:c,sim:o,droneData:s},e),T(j(o)),i.render(a,r)}})),Object(h.jsxs)("div",{style:{display:"flex",flexDirection:"row",background:"rgb(62, 62, 62)",overflow:"hidden"},children:[Object(h.jsxs)("div",{style:{position:"relative",overflow:"hidden"},children:[Object(h.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",display:"flex",flexDirection:"column"},children:[Object(h.jsxs)("div",{children:[" ",V.ms.toFixed(2)+"ms"]}),Object(h.jsxs)("div",{children:[" ",V.simTime.toFixed(2)+"ms"]}),Object(h.jsxs)("div",{children:[" ",V.deltaToSim.toFixed(2)+"ms"]}),Object(h.jsx)(D,{name:"battery",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.batteryChart}}),Object(h.jsx)(D,{name:"y",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.yChart}}),Object(h.jsx)(D,{name:"vy",arrf:function(){var e,n;return null===(e=t.current)||void 0===e||null===(n=e.sim)||void 0===n?void 0:n.vyChart}})]}),Object(h.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translate(-50%,0%)"},children:Object(h.jsx)("input",(e={type:"range",min:"0",max:"1",value:"0",step:"0.01"},Object(s.a)(e,"value",V.throttle),Object(s.a)(e,"onChange",(function(e){return t.current.sim.throttle=parseFloat(e.target.value)})),e))}),Object(h.jsx)("canvas",{ref:n,style:{flex:"1 1 auto"}})]}),Object(h.jsxs)("div",{style:{width:"300px",overflowY:"auto",height:"100%"},children:[Object(h.jsx)(C,{name:"motor center distance",unit:"mm",value:o.motorCenterDistance,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorCenterDistance:e})}))}}),Object(h.jsx)(C,{name:"motor kv",unit:"RPM/V",value:o.motorKV,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorKV:e})}))}}),Object(h.jsx)(C,{name:"single motor mass",unit:"g",value:o.motorMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorMass:e})}))}}),Object(h.jsx)(C,{name:"motor lift",unit:"N/W",value:o.motorLiftPerWatt,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{motorLiftPerWatt:e})}))}}),Object(h.jsx)(C,{name:"single esc mass",unit:"g",value:o.escMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{escMass:e})}))}}),Object(h.jsx)(C,{name:"battery mass",unit:"g",value:o.batteryMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryMass:e})}))}}),Object(h.jsx)(C,{name:"battery capacity",unit:"mAh",value:o.batteryCapacity,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryCapacity:e})}))}}),Object(h.jsx)(C,{name:"battery S",unit:"",value:o.batteryS,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryS:e})}))}}),Object(h.jsx)(C,{name:"battery P",unit:"",value:o.batteryP,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryP:e})}))}}),Object(h.jsx)(C,{name:"battery C",unit:"h-1",value:o.batteryC,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{batteryC:e})}))}}),Object(h.jsx)(C,{name:"frame mass",unit:"g",value:o.frameMass,setValue:function(e){return L((function(t){return Object(d.a)(Object(d.a)({},t),{},{frameMass:e})}))}}),Object(h.jsx)(B,{name:"total mass",unit:"g",value:o.totalMass}),Object(h.jsx)(B,{name:"total V",unit:"V",value:o.v}),Object(h.jsx)(B,{name:"max current",unit:"mA",value:o.mA}),Object(h.jsx)(B,{name:"max power",unit:"W",value:o.w})]})]})}function C(e){var t=e.name,n=e.unit,r=e.value,a=e.setValue;return Object(h.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"10px"},children:[Object(h.jsx)("div",{style:{textAlign:"left"},children:t}),Object(h.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"120px",flex:"none"},children:[Object(h.jsx)("input",{style:{width:"60px"},value:r,type:"number",onChange:function(e){var t=parseFloat(e.target.value);a(t)}})," ",Object(h.jsx)("span",{style:{marginLeft:"5px"},children:n})]})]})}function B(e){var t=e.name,n=e.unit,r=e.value;return Object(h.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"10px"},children:[Object(h.jsx)("div",{style:{textAlign:"left"},children:t}),Object(h.jsxs)("div",{style:{color:"white",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"120px",flex:"none"},children:[Object(h.jsx)("input",{disabled:!0,style:{width:"60px"},value:r})," ",Object(h.jsx)("span",{style:{marginLeft:"5px"},children:n})]})]})}function D(e){var t=e.arrf,n=e.name,a=Object(r.useRef)(),i=Object(r.useRef)({min:9999,max:-9999,lastComputeIndex:-1}),o=Object(r.useState)(0),s=Object(m.a)(o,2),c=s[0],u=s[1],l=200,d=200;return b((function(e){var n=t();if(a.current&&n&&i.current){i.current.lastComputeIndex>n.length-1&&(i.current={min:9999,max:-9999,lastComputeIndex:-1});var r=i.current;a.current.width=l,a.current.height=d;var o=a.current.getContext("2d");o.width=l,o.height=d,o.fillStyle="rgba(0,0,0,0.2)",o.fillRect(0,0,l,d),n.length>0&&u(n[n.length-1]);for(var s=r.lastComputeIndex+1;s<n.length;s++)r.min=Math.min(r.min,n[s]),r.max=Math.max(r.max,n[s]);r.lastComputeIndex=n.length-1;var c=r.max-r.min,m=r.max+c/10,f=r.min-c/10,b=function(e){return d-d*(e-f)/(m-f)},h=function(e){return e*l/(n.length-1)};o.beginPath(),o.moveTo(h(0),b(n[0]||0)),n.forEach((function(e,t){o.lineTo(h(t),b(e))})),o.strokeStyle="#fff",o.stroke()}})),Object(h.jsxs)("div",{style:{border:"1px solid black",background:"rgba(0,0,0,0.6)",color:"white"},children:[Object(h.jsxs)("div",{children:[n,": ",c.toFixed(2)]}),Object(h.jsx)("canvas",{ref:a,style:{width:l+"px",height:d+"px"}})]})}var V=function(){return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(S,{})})},T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};o.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(V,{})}),document.getElementById("root")),T()}},[[39,1,2]]]);
//# sourceMappingURL=main.20744e1d.chunk.js.map